// Copyright (c) 2013 Mathieu Turcotte
// Licensed under the MIT license.

package bc

import "io"

// Padding sent to overcome IE<10 full page buffering.
var iePadding = []byte{
	0x37, 0x63, 0x63, 0x61, 0x36, 0x39, 0x34, 0x37, 0x35, 0x33, 0x36, 0x33,
	0x30, 0x32, 0x36, 0x33, 0x33, 0x30, 0x61, 0x30, 0x64, 0x39, 0x39, 0x34,
	0x36, 0x38, 0x65, 0x38, 0x38, 0x64, 0x32, 0x33, 0x63, 0x65, 0x39, 0x35,
	0x65, 0x32, 0x32, 0x32, 0x35, 0x39, 0x31, 0x31, 0x32, 0x36, 0x34, 0x34,
	0x33, 0x30, 0x31, 0x35, 0x66, 0x35, 0x66, 0x34, 0x36, 0x32, 0x64, 0x39,
	0x61, 0x31, 0x37, 0x37, 0x31, 0x38, 0x36, 0x63, 0x38, 0x37, 0x30, 0x31,
	0x66, 0x62, 0x34, 0x35, 0x61, 0x36, 0x66, 0x66, 0x65, 0x65, 0x30, 0x64,
	0x61, 0x66, 0x31, 0x61, 0x31, 0x37, 0x38, 0x66, 0x63, 0x30, 0x66, 0x35,
	0x38, 0x63, 0x64, 0x33, 0x30, 0x39, 0x33, 0x30, 0x38, 0x66, 0x62, 0x61,
	0x37, 0x65, 0x36, 0x66, 0x30, 0x31, 0x31, 0x61, 0x63, 0x33, 0x38, 0x63,
	0x39, 0x63, 0x64, 0x64, 0x34, 0x35, 0x38, 0x30, 0x37, 0x36, 0x30, 0x66,
	0x31, 0x64, 0x34, 0x35, 0x36, 0x30, 0x61, 0x38, 0x34, 0x64, 0x35, 0x63,
	0x61, 0x30, 0x33, 0x35, 0x35, 0x65, 0x63, 0x62, 0x62, 0x65, 0x64, 0x32,
	0x61, 0x62, 0x37, 0x31, 0x35, 0x61, 0x33, 0x33, 0x35, 0x30, 0x66, 0x65,
	0x30, 0x63, 0x34, 0x37, 0x39, 0x30, 0x35, 0x30, 0x36, 0x34, 0x30, 0x62,
	0x64, 0x30, 0x65, 0x37, 0x37, 0x61, 0x63, 0x65, 0x63, 0x39, 0x30, 0x63,
	0x35, 0x38, 0x63, 0x34, 0x64, 0x33, 0x64, 0x64, 0x30, 0x66, 0x35, 0x63,
	0x66, 0x38, 0x64, 0x34, 0x35, 0x31, 0x30, 0x65, 0x36, 0x38, 0x63, 0x38,
	0x62, 0x31, 0x32, 0x65, 0x30, 0x38, 0x37, 0x62, 0x64, 0x38, 0x38, 0x63,
	0x61, 0x64, 0x33, 0x34, 0x39, 0x61, 0x61, 0x66, 0x64, 0x32, 0x61, 0x62,
	0x31, 0x36, 0x62, 0x30, 0x37, 0x62, 0x30, 0x62, 0x31, 0x62, 0x38, 0x32,
	0x37, 0x36, 0x30, 0x39, 0x31, 0x32, 0x31, 0x37, 0x61, 0x34, 0x34, 0x61,
	0x39, 0x66, 0x65, 0x39, 0x32, 0x66, 0x65, 0x64, 0x61, 0x63, 0x66, 0x66,
	0x66, 0x66, 0x34, 0x38, 0x30, 0x39, 0x32, 0x65, 0x65, 0x36, 0x39, 0x33,
	0x61, 0x66}

func writeHtmlHead(w io.Writer) (int, error) {
	return io.WriteString(w, "<html><body>")
}

func writeHtmlDomain(w io.Writer, domain string) (int, error) {
	return writeScriptBlock(w, "document.domain='"+domain+"'")
}

func writeHtmlPadding(w io.Writer) (int, error) {
	return w.Write(iePadding)
}

func writeScriptBlock(w io.Writer, content string) (int, error) {
	return io.WriteString(w, "<script>try {"+content+";} catch(e) {}</script>")
}

func writeHtmlRpc(w io.Writer, content string) (int, error) {
	return writeScriptBlock(w, "parent.m('"+content+"')")
}

func writeHtmlDone(w io.Writer) (int, error) {
	return writeScriptBlock(w, "parent.d()")
}
